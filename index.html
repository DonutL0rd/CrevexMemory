<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Trainer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #0a0a0a;
            min-height: 100vh;
            padding: 20px;
            color: #e0e0e0;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 24px;
            box-shadow: 0 8px 32px rgba(139, 92, 246, 0.2);
            max-width: 1000px;
            width: 100%;
            padding: 48px;
            border: 1px solid rgba(139, 92, 246, 0.2);
            backdrop-filter: blur(10px);
        }

        .header {
            text-align: center;
            margin-bottom: 48px;
        }

        h1 {
            background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 3em;
            font-weight: 800;
            margin-bottom: 12px;
            letter-spacing: -1px;
        }

        .subtitle {
            color: #9ca3af;
            font-size: 16px;
        }

        .progress-steps {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-bottom: 40px;
        }

        .step {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(139, 92, 246, 0.1);
            border-radius: 12px;
            border: 1px solid transparent;
            transition: all 0.3s;
        }

        .step.active {
            background: rgba(139, 92, 246, 0.2);
            border-color: #8b5cf6;
        }

        .step.completed {
            background: rgba(34, 197, 94, 0.1);
            border-color: #22c55e;
        }

        .step-number {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: rgba(139, 92, 246, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
            color: #a78bfa;
        }

        .step.active .step-number {
            background: #8b5cf6;
            color: white;
        }

        .step.completed .step-number {
            background: #22c55e;
            color: white;
        }

        .step-label {
            font-size: 14px;
            font-weight: 600;
            color: #9ca3af;
        }

        .step.active .step-label {
            color: #a78bfa;
        }

        .step.completed .step-label {
            color: #22c55e;
        }

        .section {
            margin-bottom: 32px;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 12px;
            color: #e0e0e0;
            font-size: 15px;
        }

        textarea {
            width: 100%;
            padding: 16px;
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(139, 92, 246, 0.3);
            border-radius: 16px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            color: #e0e0e0;
            transition: all 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #8b5cf6;
            background: rgba(0, 0, 0, 0.5);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        textarea::placeholder {
            color: #6b7280;
        }

        .button-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        button {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
        }

        .primary-btn {
            background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);
            color: white;
            flex: 1;
            min-width: 180px;
            box-shadow: 0 4px 16px rgba(139, 92, 246, 0.4);
        }

        .primary-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(139, 92, 246, 0.5);
        }

        .primary-btn:active {
            transform: translateY(0);
        }

        .secondary-btn {
            background: rgba(139, 92, 246, 0.1);
            color: #a78bfa;
            border: 1px solid rgba(139, 92, 246, 0.3);
        }

        .secondary-btn:hover {
            background: rgba(139, 92, 246, 0.2);
            border-color: #8b5cf6;
        }

        .sentence-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .sentence-controls button {
            flex: 1;
        }

        .sentence-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 8px;
        }

        .sentence-list::-webkit-scrollbar {
            width: 8px;
        }

        .sentence-list::-webkit-scrollbar-track {
            background: rgba(139, 92, 246, 0.1);
            border-radius: 4px;
        }

        .sentence-list::-webkit-scrollbar-thumb {
            background: rgba(139, 92, 246, 0.3);
            border-radius: 4px;
        }

        .sentence-list::-webkit-scrollbar-thumb:hover {
            background: rgba(139, 92, 246, 0.5);
        }

        .sentence-item {
            padding: 16px;
            border: 2px solid rgba(139, 92, 246, 0.2);
            border-radius: 12px;
            display: flex;
            align-items: flex-start;
            gap: 16px;
            transition: all 0.3s;
            background: rgba(0, 0, 0, 0.3);
            cursor: pointer;
        }

        .sentence-item:hover {
            border-color: #8b5cf6;
            background: rgba(139, 92, 246, 0.1);
            transform: translateX(4px);
        }

        .sentence-item.selected {
            border-color: #a78bfa;
            background: rgba(139, 92, 246, 0.15);
            box-shadow: 0 4px 16px rgba(139, 92, 246, 0.2);
        }

        .sentence-checkbox {
            width: 22px;
            height: 22px;
            cursor: pointer;
            flex-shrink: 0;
            margin-top: 2px;
            accent-color: #8b5cf6;
        }

        .sentence-text {
            flex: 1;
            line-height: 1.6;
            color: #d1d5db;
        }

        .sentence-number {
            background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 700;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(139, 92, 246, 0.3);
        }

        .hidden {
            display: none;
        }

        .selected-preview {
            background: rgba(139, 92, 246, 0.1);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 24px;
            border: 2px solid rgba(139, 92, 246, 0.3);
        }

        .selected-preview h4 {
            color: #a78bfa;
            margin-bottom: 12px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .selected-preview-text {
            color: #e0e0e0;
            line-height: 1.8;
            font-size: 15px;
        }

        .comparison {
            margin-top: 32px;
            padding: 24px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            border: 1px solid rgba(139, 92, 246, 0.2);
        }

        .comparison h3 {
            color: #a78bfa;
            margin-bottom: 20px;
            font-size: 20px;
        }

        .diff-container {
            font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
            line-height: 2;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 15px;
        }

        .correct {
            background: rgba(34, 197, 94, 0.2);
            color: #4ade80;
            padding: 3px 6px;
            border-radius: 4px;
        }

        .incorrect {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
            padding: 3px 6px;
            border-radius: 4px;
        }

        #originalDisplay .incorrect {
            text-decoration: none;
        }

        #userDisplay .incorrect {
            text-decoration: line-through;
        }

        .missing {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
            padding: 3px 6px;
            border-radius: 4px;
        }

        .legend {
            display: flex;
            gap: 20px;
            margin-bottom: 24px;
            padding: 16px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-badge {
            padding: 4px 10px;
            border-radius: 4px;
            font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            font-weight: 600;
        }

        .legend-label {
            color: #d1d5db;
            font-size: 14px;
        }

        .stats {
            margin-bottom: 24px;
            padding: 20px;
            background: rgba(139, 92, 246, 0.05);
            border-radius: 12px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 20px;
            text-align: center;
            border: 1px solid rgba(139, 92, 246, 0.1);
        }

        .stat {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 800;
            background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            font-size: 12px;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
        }

        .instructions {
            background: rgba(139, 92, 246, 0.1);
            padding: 16px 20px;
            border-radius: 12px;
            margin-bottom: 28px;
            color: #d1d5db;
            font-size: 14px;
            line-height: 1.6;
            border-left: 4px solid #8b5cf6;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .welcome-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease-in;
        }

        .welcome-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 24px;
            padding: 48px;
            max-width: 600px;
            width: 90%;
            border: 2px solid rgba(139, 92, 246, 0.3);
            box-shadow: 0 20px 60px rgba(139, 92, 246, 0.3);
            text-align: center;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .welcome-content h2 {
            background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2.5em;
            font-weight: 800;
            margin-bottom: 20px;
        }

        .welcome-content p {
            color: #d1d5db;
            font-size: 18px;
            line-height: 1.8;
            margin-bottom: 16px;
        }

        .welcome-features {
            text-align: left;
            margin: 32px 0;
            padding: 24px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            border: 1px solid rgba(139, 92, 246, 0.2);
        }

        .welcome-feature {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 16px;
            color: #d1d5db;
            font-size: 15px;
        }

        .welcome-feature:last-child {
            margin-bottom: 0;
        }

        .welcome-icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .welcome-btn {
            background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);
            color: white;
            padding: 16px 40px;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 16px rgba(139, 92, 246, 0.4);
            margin-top: 24px;
        }

        .welcome-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(139, 92, 246, 0.6);
        }

        .count-badge {
            display: inline-block;
            background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 700;
            margin-left: 8px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 24px;
            }

            h1 {
                font-size: 2em;
            }

            .progress-steps {
                flex-direction: column;
                gap: 8px;
            }

            .step {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="welcome-modal" id="welcomeModal">
        <div class="welcome-content">
            <h2>üëã Welcome!</h2>
            <p>Master any text with our interactive memory trainer</p>
            
            <div class="welcome-features">
                <div class="welcome-feature">
                    <span class="welcome-icon">üìù</span>
                    <span><strong>Paste any text</strong> - verses, quotes, poems, speeches, or anything you want to memorize</span>
                </div>
                <div class="welcome-feature">
                    <span class="welcome-icon">‚úÇÔ∏è</span>
                    <span><strong>Split into sentences</strong> - choose exactly which parts you want to study</span>
                </div>
                <div class="welcome-feature">
                    <span class="welcome-icon">üß†</span>
                    <span><strong>Test yourself</strong> - type from memory and get instant feedback</span>
                </div>
                <div class="welcome-feature">
                    <span class="welcome-icon">üìä</span>
                    <span><strong>Track progress</strong> - see exactly what you missed with color-coded results</span>
                </div>
            </div>

            <button class="welcome-btn" onclick="closeWelcome()">Get Started ‚Üí</button>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>‚ú® Memory Trainer</h1>
            <p class="subtitle">Master any text with adaptive learning</p>
        </div>

        <div class="progress-steps">
            <div class="step" id="step1">
                <div class="step-number">1</div>
                <div class="step-label">Input Text</div>
            </div>
            <div class="step" id="step2">
                <div class="step-number">2</div>
                <div class="step-label">Select Sentences</div>
            </div>
            <div class="step" id="step3">
                <div class="step-number">3</div>
                <div class="step-label">Practice</div>
            </div>
        </div>

        <div id="setupMode">
            <div class="instructions">
                üí° Paste any text you want to memorize, split it into sentences, select what you'd like to study, and start training!
            </div>

            <div class="section">
                <label for="originalText">Your Text</label>
                <textarea id="originalText" rows="8" placeholder="Paste your verse, quote, poem, or any text..."></textarea>
            </div>

            <div class="button-group">
                <button class="primary-btn" onclick="splitSentences()">Split into Sentences ‚Üí</button>
            </div>

            <div class="section hidden" id="sentenceSection">
                <label>
                    Choose Sentences to Study
                    <span class="count-badge" id="selectedCount">0 selected</span>
                </label>
                <div class="sentence-controls">
                    <button class="secondary-btn" onclick="selectAll()">‚úì Select All</button>
                    <button class="secondary-btn" onclick="deselectAll()">‚úó Clear All</button>
                </div>
                <div class="sentence-list" id="sentenceList"></div>
            </div>

            <div class="section hidden" id="previewSection">
                <div class="selected-preview">
                    <h4>üìù Your Study Material</h4>
                    <div class="selected-preview-text" id="selectedPreview"></div>
                </div>
                <button class="primary-btn" onclick="startTraining()">Begin Training ‚Üí</button>
            </div>
        </div>

        <div id="trainingMode" class="hidden">
            <div class="instructions">
                üß† Type the text from memory. Don't worry about being perfect ‚Äî you'll get detailed feedback!
            </div>

            <div class="section">
                <label for="userAnswer">Type From Memory</label>
                <textarea id="userAnswer" rows="10" placeholder="Start typing what you remember..." autofocus></textarea>
            </div>

            <div class="button-group">
                <button class="primary-btn" onclick="checkAnswer()">Check My Answer</button>
                <button class="secondary-btn" onclick="resetTraining()">‚Üê Start Over</button>
            </div>

            <div id="comparisonSection" class="comparison hidden">
                <h3>üìä Results</h3>
                <div class="stats">
                    <div class="stat">
                        <div class="stat-value" id="accuracy">-</div>
                        <div class="stat-label">Accuracy</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="correctWords">-</div>
                        <div class="stat-label">Correct</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="totalWords">-</div>
                        <div class="stat-label">Total</div>
                    </div>
                </div>

                <div class="legend">
                    <div class="legend-item">
                        <span class="legend-badge correct">word</span>
                        <span class="legend-label">Correct</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-badge incorrect">word</span>
                        <span class="legend-label">Incorrect/Misspelled</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-badge missing">word</span>
                        <span class="legend-label">Missing Word</span>
                    </div>
                </div>
                
                <div style="margin-bottom: 24px;">
                    <h4 style="color: #a78bfa; margin-bottom: 12px; font-size: 14px;">Original Text (What You Should Have Written):</h4>
                    <div class="diff-container" id="originalDisplay"></div>
                </div>
                
                <div>
                    <h4 style="color: #a78bfa; margin-bottom: 12px; font-size: 14px;">Your Answer:</h4>
                    <div class="diff-container" id="userDisplay"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let allSentences = [];
        let selectedSentences = [];
        let studyText = '';

        function closeWelcome() {
            document.getElementById('welcomeModal').style.display = 'none';
        }

        function updateSteps(active) {
            document.getElementById('step1').classList.remove('active', 'completed');
            document.getElementById('step2').classList.remove('active', 'completed');
            document.getElementById('step3').classList.remove('active', 'completed');

            if (active === 1) {
                document.getElementById('step1').classList.add('active');
            } else if (active === 2) {
                document.getElementById('step1').classList.add('completed');
                document.getElementById('step2').classList.add('active');
            } else if (active === 3) {
                document.getElementById('step1').classList.add('completed');
                document.getElementById('step2').classList.add('completed');
                document.getElementById('step3').classList.add('active');
            }
        }

        updateSteps(1);

        function splitSentences() {
            const text = document.getElementById('originalText').value.trim();
            if (!text) {
                alert('Please enter some text first!');
                return;
            }

            allSentences = text.match(/[^.!?\n]+[.!?\n]+|[^.!?\n]+$/g) || [text];
            allSentences = allSentences.map(s => s.trim()).filter(s => s.length > 0);

            displaySentences();
            document.getElementById('sentenceSection').classList.remove('hidden');
            document.getElementById('sentenceSection').classList.add('fade-in');
            document.getElementById('previewSection').classList.add('hidden');
            updateSteps(2);
        }

        function displaySentences() {
            const list = document.getElementById('sentenceList');
            list.innerHTML = '';

            if (allSentences.length === 0) {
                list.innerHTML = '<div class="empty-state">No sentences found. Try pasting some text above.</div>';
                return;
            }

            allSentences.forEach((sentence, index) => {
                const item = document.createElement('div');
                item.className = 'sentence-item';
                item.onclick = () => toggleSentence(index);

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'sentence-checkbox';
                checkbox.id = `sentence-${index}`;
                checkbox.checked = false;

                const number = document.createElement('span');
                number.className = 'sentence-number';
                number.textContent = index + 1;

                const text = document.createElement('div');
                text.className = 'sentence-text';
                text.textContent = sentence;

                item.appendChild(checkbox);
                item.appendChild(number);
                item.appendChild(text);
                list.appendChild(item);
            });
        }

        function toggleSentence(index) {
            const checkbox = document.getElementById(`sentence-${index}`);
            const item = checkbox.closest('.sentence-item');
            checkbox.checked = !checkbox.checked;
            
            if (checkbox.checked) {
                item.classList.add('selected');
            } else {
                item.classList.remove('selected');
            }
            
            updateSelection();
        }

        function updateSelection() {
            selectedSentences = [];
            allSentences.forEach((sentence, index) => {
                const checkbox = document.getElementById(`sentence-${index}`);
                
                if (checkbox.checked) {
                    selectedSentences.push(index);
                }
            });

            document.getElementById('selectedCount').textContent = `${selectedSentences.length} selected`;

            if (selectedSentences.length > 0) {
                const preview = selectedSentences.map(i => allSentences[i]).join(' ');
                document.getElementById('selectedPreview').textContent = preview;
                document.getElementById('previewSection').classList.remove('hidden');
                document.getElementById('previewSection').classList.add('fade-in');
            } else {
                document.getElementById('previewSection').classList.add('hidden');
            }
        }

        function selectAll() {
            allSentences.forEach((_, index) => {
                const checkbox = document.getElementById(`sentence-${index}`);
                const item = checkbox.closest('.sentence-item');
                checkbox.checked = true;
                item.classList.add('selected');
            });
            updateSelection();
        }

        function deselectAll() {
            allSentences.forEach((_, index) => {
                const checkbox = document.getElementById(`sentence-${index}`);
                const item = checkbox.closest('.sentence-item');
                checkbox.checked = false;
                item.classList.remove('selected');
            });
            updateSelection();
        }

        function startTraining() {
            if (selectedSentences.length === 0) {
                alert('Please select at least one sentence to study!');
                return;
            }

            studyText = selectedSentences.map(i => allSentences[i]).join(' ').trim();

            document.getElementById('setupMode').classList.add('hidden');
            document.getElementById('trainingMode').classList.remove('hidden');
            document.getElementById('trainingMode').classList.add('fade-in');
            document.getElementById('userAnswer').value = '';
            document.getElementById('comparisonSection').classList.add('hidden');
            document.getElementById('userAnswer').focus();
            updateSteps(3);
        }

        function checkAnswer() {
            const userAnswer = document.getElementById('userAnswer').value.trim();
            if (!userAnswer) {
                alert('Please type your answer first!');
                return;
            }

            const original = normalizeText(studyText);
            const user = normalizeText(userAnswer);

            const diff = computeDiff(original, user);
            displayDiff(diff);

            document.getElementById('comparisonSection').classList.remove('hidden');
            document.getElementById('comparisonSection').classList.add('fade-in');
        }

        function normalizeText(text) {
            return text.trim().split(/\s+/);
        }

        function computeDiff(original, user) {
            const result = [];
            let correctCount = 0;

            const maxLen = Math.max(original.length, user.length);
            
            for (let i = 0; i < maxLen; i++) {
                if (i >= original.length) {
                    result.push({ word: user[i], type: 'extra' });
                } else if (i >= user.length) {
                    result.push({ word: original[i], type: 'missing', expected: original[i] });
                } else if (original[i].toLowerCase() === user[i].toLowerCase()) {
                    result.push({ word: user[i], type: 'correct', expected: original[i] });
                    correctCount++;
                } else {
                    result.push({ word: user[i], type: 'incorrect', expected: original[i] });
                }
            }

            const accuracy = original.length > 0 ? Math.round((correctCount / original.length) * 100) : 0;

            document.getElementById('accuracy').textContent = accuracy + '%';
            document.getElementById('correctWords').textContent = correctCount;
            document.getElementById('totalWords').textContent = original.length;

            return result;
        }

        function displayDiff(diff) {
            const originalContainer = document.getElementById('originalDisplay');
            const userContainer = document.getElementById('userDisplay');
            originalContainer.innerHTML = '';
            userContainer.innerHTML = '';

            diff.forEach(item => {
                // Display in original text container
                const originalSpan = document.createElement('span');
                
                if (item.type === 'correct') {
                    originalSpan.className = 'correct';
                    originalSpan.textContent = item.expected || item.word;
                    originalSpan.title = 'You got this correct!';
                } else if (item.type === 'incorrect') {
                    originalSpan.className = 'incorrect';
                    originalSpan.textContent = item.expected;
                    originalSpan.title = `You wrote: ${item.word}`;
                } else if (item.type === 'missing') {
                    originalSpan.className = 'missing';
                    originalSpan.textContent = item.word;
                    originalSpan.title = 'You missed this word';
                } else if (item.type === 'extra') {
                    // Don't show extra words in original text
                }
                
                if (item.type !== 'extra') {
                    originalContainer.appendChild(originalSpan);
                    originalContainer.appendChild(document.createTextNode(' '));
                }

                // Display in user's answer container
                if (item.type !== 'missing') {
                    const userSpan = document.createElement('span');
                    
                    if (item.type === 'correct') {
                        userSpan.className = 'correct';
                        userSpan.textContent = item.word;
                    } else if (item.type === 'incorrect') {
                        userSpan.className = 'incorrect';
                        userSpan.textContent = item.word;
                        userSpan.title = `Should be: ${item.expected}`;
                    } else if (item.type === 'extra') {
                        userSpan.className = 'incorrect';
                        userSpan.textContent = item.word;
                        userSpan.title = 'Extra word - not in original';
                    }
                    
                    userContainer.appendChild(userSpan);
                    userContainer.appendChild(document.createTextNode(' '));
                }
            });
        }

        function resetTraining() {
            document.getElementById('setupMode').classList.remove('hidden');
            document.getElementById('trainingMode').classList.add('hidden');
            document.getElementById('comparisonSection').classList.add('hidden');
            updateSteps(1);
        }
    </script>
</body>
</html>